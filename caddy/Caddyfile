# Caddyfile for Auto-Claude
# Caddy automatically manages HTTPS certificates

# For Tailscale hostname (uses Let's Encrypt automatically)
{$HOSTNAME:localhost} {
    # Serve React frontend
    root * /srv
    file_server
    try_files {path} /index.html

    # API proxy
    handle /api/* {
        reverse_proxy backend:8000
    }

    # WebSocket proxy (main app)
    handle /ws/* {
        reverse_proxy backend:8000
    }

    # Health check
    handle /health {
        respond "OK" 200
    }

    # Security headers
    header {
        X-Frame-Options "SAMEORIGIN"
        X-Content-Type-Options "nosniff"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
    }

    # Gzip compression
    encode gzip
}

# For internal/private hostnames, use Caddy's internal CA
# Uncomment and modify if needed:
# {
#     local_certs  # Use Caddy's internal CA for non-public domains
# }
